# Background / Scenario {#background-scenario}

Poorly secured and managed Windows server networks are a huge security
risk. Penetration testers must uncover any vulnerabilities in file and
print sharing functions that can leave an organization vulnerable to
attack. In this activity, you will explore the capabilities of the
enum4linux tool to enumerate user and file sharing information from
Samba servers. Finally, you will use the smbclient utility to transfer
files between systems.

In this lab you will get familiar with a popular tool that is used to
discover network shares and other sensitive information through the
exploitation of SMB. You will also conduct a simulated exploit in which
you transfer an unauthorized and potentially malicious file to an
unprotected share.

# Required Resources

- Customized Kali Linux Vm for Ethical Hacker course
- Internet access

## Launch enum4linux and explore its capabilities. {#launch-enum4linux-and-explore-its-capabilities.}

Server Message Block (SMB) is a Microsoft protocol that is available on
non-Microsoft networks through the open-source Samba service. SMB makes
it easy to set up and access network shares on LANs.

TOPOLOGY

<img width="1011" height="638" alt="image" src="https://github.com/user-attachments/assets/c0a5eb72-f9ba-4d4d-bc7e-e57ce98ff4e0" />


### Verify that enum4linux is installed and view the help file

Most enum4linux commands must be run as root, so use the **sudo su
**command to obtain persistent root access.

At the prompt, enter the command to view the enum4linux help file.

┌──(kali㉿kali)-\[\~\]

└─\$ **sudo su**

\[sudo\] password for kali:

┌──(root㉿kali)-\[/home/kali\]

└─# **enum4linux -help**

The help file contains the syntax and options available to enumerate
host and server information on networks that use SMB. Enum4linux
requires that Samba be installed on the host system, in this case the
Kali Linux computer, because it is dependent on the built-in Samba
utilities.

OUTPUT:

<img width="1238" height="567" alt="image" src="https://github.com/user-attachments/assets/819a412a-cbf3-4239-895f-921c1d0422f6" />


<img width="1290" height="822" alt="image" src="https://github.com/user-attachments/assets/2f092c72-c18a-42dc-8fb4-266c5969294b" />


Using **-U **with enum4linux to get the UserList

┌──(root㉿kali)-\[/home/kali\]

└─# **enum4linux -U 172.17.0.2**

OUTPUT:
<img width="1567" height="854" alt="image" src="https://github.com/user-attachments/assets/24a2c174-58bc-4850-91fc-09ade52721fb" />
<img width="1566" height="852" alt="image" src="https://github.com/user-attachments/assets/48f56bc4-ed37-4897-bc67-4ae071c6d6f4" />

<img width="1417" height="880" alt="image" src="https://github.com/user-attachments/assets/e6e9bba6-8a6e-4063-bcc7-b9d480018d95" />


Using **-S **with enum4linux to get the ShareList

┌──(root㉿kali)-\[/home/kali\]

└─# **enum4linux -S 172.17.0.2**

OUTPUT:
<img width="1590" height="830" alt="image" src="https://github.com/user-attachments/assets/97c2038a-2b2d-4284-9e29-7fe835f173cb" />

<img width="1483" height="872" alt="image" src="https://github.com/user-attachments/assets/61b36a3d-de11-49a5-870c-0eaaaea6ce71" />


Using **-Sv **with enum4linux

┌──(root㉿kali)-\[/home/kali\]

└─# **enum4linux -Sv 172.17.0.2**

****Note the \[V\]** **at the beginning of some of the lines of output.
The verbose mode provides a narrative of how the results were
obtained.****

**OUTPUT:**
<img width="1596" height="850" alt="image" src="https://github.com/user-attachments/assets/05b8fe43-bc90-4548-bd98-7ec24b5a363c" />** **

<img width="1614" height="860" alt="image" src="https://github.com/user-attachments/assets/08dca651-0759-4690-8483-c424cc928403" />
** **
<img width="1651" height="845" alt="image" src="https://github.com/user-attachments/assets/92e10167-24b6-488e-8a27-7e9c3b1e8d4f" />** **
<img width="1693" height="851" alt="image" src="https://github.com/user-attachments/assets/d373fea8-c5f6-4673-a8b0-91bcbf6b98a2" />** **

Using **-P **with enum4linux to get Password Policy Information

┌──(root㉿kali)-\[/home/kali\]

└─# **enum4linux -P 172.17.0.2**

OUTPUT:

<img width="1461" height="880" alt="image" src="https://github.com/user-attachments/assets/1bd6689b-09ad-4c6b-a25a-c09716a9a49b" />
** **

<img width="1657" height="864" alt="image" src="https://github.com/user-attachments/assets/2447cd1b-6c05-447a-8b28-ba53ae9dbcc5" />
** **

<img width="1152" height="873" alt="image" src="https://github.com/user-attachments/assets/aa07d4c3-3d41-4531-94ff-ee5ff4117b0d" />
** **

** **

Using **-a **with enum4linux to **Do all simple enumeration (-U -S -G -P
-r -o -n -i)**

┌──(root㉿kali)-\[/home/kali\]

└─# **enum4linux -a 172.17.0.2**

**OUTPUT:**

<img width="1514" height="822" alt="image" src="https://github.com/user-attachments/assets/d8932e1b-2cf9-4f86-bd2b-ea688113be04" />
** **

<img width="1459" height="903" alt="image" src="https://github.com/user-attachments/assets/da6ffcfd-5bb4-4220-bc9a-181dd0c422c7" />

<img width="1449" height="889" alt="image" src="https://github.com/user-attachments/assets/47d7a4cf-562e-4dac-96c2-8a5598b5ca21" />* **
<img width="1602" height="866" alt="image" src="https://github.com/user-attachments/assets/db0bb687-fc44-4001-81d9-df41bb187e34" />** **

## **Use Nmap to Find SMB Servers**

### **Scan the virtual networks to find potential targets.** {#scan-the-virtual-networks-to-find-potential-targets.}

One way to identify potential targets for SMB enumeration is to examine
the open ports. In an earlier lab, you used Nmap to find and enumerate
open ports on target systems. Common open ports on SMB servers are:

TCP 135 RPC

TCP 139 NetBIOS Session

TCP 389 LDAP Server

TCP 445 SMB File Service

TCP 9389 Active Directory Web Services

TCP/UDP 137 NetBIOS Name Service

UDP 138 NetBIOS Datagram

****Use the **nmap -sN **command to find the services available on hosts
in the 172.17.0.0 virtual network.****

**Note**: **sudo **is not required if you executed the **sudo su
**command above.

┌──(root㉿kali)-\[/home/kali\]

└─# **nmap -sN 172.17.0.0/24 **

**OUTPUT:**

<img width="1477" height="927" alt="image" src="https://github.com/user-attachments/assets/aaad6eda-cebb-4c67-b191-3aabe8778f78" />
** **

****

****Take a look at the options available with smbclient using the
command **smbclient --help **command.****

┌──(root㉿kali)-\[/home/kali\]

└─# **smbclient \--help**

3.  

**OUTPUT:**
<img width="1207" height="731" alt="image" src="https://github.com/user-attachments/assets/661a1690-d82b-4aba-aab8-219cf1b12f80" />** **
<img width="1178" height="742" alt="image" src="https://github.com/user-attachments/assets/afcd5036-acb9-4b51-aef0-827084b0e741" />** **

****Use the ****smbclient -L** **command to list the shares on the
target host. This command produces a similar output to what the
enum4linx command ****we ****did****

****┌──****(root****㉿****kali)-\[/home/kali\]****

└─# **smbclient -L //172.17.0.2/**

****Password for \[WORKGROUPkali\]: **\<Press enter\>**

**OUTPUT:**
<img width="1536" height="698" alt="image" src="https://github.com/user-attachments/assets/bb74df5d-4944-451a-b762-cbcf5dda7930" />** **

****lets connect with print\$ ****

┌──(root㉿kali)-\[/home/kali\]

****└─****\# **smbclient //172.17.0.2/print\$**

**OUTPUT:**

<img width="1506" height="232" alt="image" src="https://github.com/user-attachments/assets/e61ad45f-896f-4585-ba5c-47ac4b1df467" />


****

****Connect to the **tmp **share using the **smbclient **command by
specifying the share name and IP address.****

┌──(root㉿kali)-\[/home/kali\]

└─# **smbclient //172.17.0.2/tmp**

Password for \[WORKGROUPkali\]: **\<Press enter\>**

smb: \>

Note that the prompt changed to the **smb:\> **prompt. Type **help **to
see what commands are available.

OUTPUT:

<img width="971" height="189" alt="image" src="https://github.com/user-attachments/assets/7b720239-8fda-4f2c-abb1-37a872186953" />


Type **help **to see what commands are available.

<img width="980" height="643" alt="image" src="https://github.com/user-attachments/assets/6db5fe9b-a480-409f-a8f1-31dfd04b09ad" />
** **

****Enter **dir **to view the contents of the share.****

**OUTPUT:**
<img width="1203" height="526" alt="image" src="https://github.com/user-attachments/assets/aa733540-2ed8-45af-bd44-110a8517c4fd" />** **

## **Use smbclient to transfer files between systems**

****Smbclient is a component of Samba that can store and retrieve files,
similar to an FTP client. You will use smbclient to transfer a file to
the target system at 172.17.0.2. This simulates exploiting a network
host with malware through an SMB vulnerability.****

1.  

    Create a text file using the **cat **command. Name the file
    **virus.txt or virus.exe**. Enter the desired text. In this example,
    **This is a bad file. **was used. Be sure that you know the path to
    the file. Press **CTRL-C **to when finished.

┌──(root㉿kali)-\[/home/kali\]

└─# **cat \>\> badfile.txt**

**This is a bad file.**

Press CRTL-C to write the file.

****Upload the **virus.txt or virus.exe **to the target server using the
**put **command. The syntax for the command is:****

**put ******local-file-name****** ******remote-file-name********

smb: \> **put virus.txt or virus.exe group_work.txt**

Putting file badfile.txt as badfile.txt (19.5 kb/s) (average 19.5 kb/s)

OUTPUT:

<img width="1246" height="617" alt="image" src="https://github.com/user-attachments/assets/cbe66065-febd-49c8-9c73-8ae5350d68bf" />


  Verify that the file successfully uploaded using the **dir
    **command.

smb: \> **dir**

  <img width="1246" height="617" alt="image" src="https://github.com/user-attachments/assets/04be1f5e-fc1d-47c3-bf9f-b2b2d537cb16" />


    Type **quit **to exit the **smbclient **and return to the CLI
    prompt.
